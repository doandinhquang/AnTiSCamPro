<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin - Duy·ªát D·ªØ Li·ªáu Anti Scam</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f4f7fe; padding: 40px; }
        .admin-card { background: white; max-width: 800px; margin: 0 auto; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { color: #5471ff; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .info { flex-grow: 1; }
        .info b { color: #333; font-size: 1.1rem; }
        .info span { display: block; font-size: 0.8rem; color: #888; }
        .actions { display: flex; gap: 10px; }
        button { border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-approve { background: #4caf50; color: white; }
        .btn-delete { background: #ff5252; color: white; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #5471ff; display: flex; justify-content: center; align-items: center; z-index: 100; }
        .login-box { background: white; padding: 30px; border-radius: 15px; text-align: center; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; width: 200px; text-align: center; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h3>Nh·∫≠p M√£ PIN Admin</h3>
            <input type="password" id="pinInput" placeholder="M√£ PIN c·ªßa b·∫°n">
            <br>
            <button class="btn-approve" onclick="checkPin()">Truy c·∫≠p</button>
        </div>
    </div>

    <div class="admin-card">
        <h2>Danh s√°ch ch·ªù ph√™ duy·ªát</h2>
        <div id="pendingList">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>

    <script>
        const BASE_URL = "https://doanquang-default-rtdb.firebaseio.com/";
        const ADMIN_PIN = "quang2203"; // <--- THAY ƒê·ªîI M√É PIN C·ª¶A B·∫†N T·∫†I ƒê√ÇY

        function checkPin() {
            const pin = document.getElementById('pinInput').value;
            if (pin === ADMIN_PIN) {
                document.getElementById('loginOverlay').style.display = 'none';
                loadPendingData();
            } else {
                alert("Sai m√£ PIN!");
            }
        }

        async function loadPendingData() {
            const listDiv = document.getElementById('pendingList');
            try {
                const response = await fetch(`${BASE_URL}pending.json`);
                const data = await response.json();
                
                if (!data) {
                    listDiv.innerHTML = "<p>üéâ Tuy·ªát v·ªùi! Kh√¥ng c√≥ y√™u c·∫ßu n√†o ƒëang ch·ªù.</p>";
                    return;
                }

                listDiv.innerHTML = "";
                // Duy·ªát qua t·ª´ng ID trong Firebase
                Object.keys(data).forEach(id => {
                    const item = data[id];
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <div class="info">
                            <b>${item.value}</b>
                            <span>Lo·∫°i: ${item.type} | Ng√†y g·ª≠i: ${item.date}</span>
                        </div>
                        <div class="actions">
                            <button class="btn-approve" onclick="approveScam('${id}', '${item.value}', '${item.type}')">Duy·ªát</button>
                            <button class="btn-delete" onclick="deletePending('${id}')">X√≥a</button>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (e) {
                listDiv.innerHTML = "L·ªói t·∫£i d·ªØ li·ªáu!";
            }
        }

        async function approveScam(id, value, type) {
            // 1. ƒê∆∞a v√†o m·ª•c scams
            await fetch(`${BASE_URL}scams.json`, {
                method: 'POST',
                body: JSON.stringify({ value, type, date: new Date().toLocaleString() })
            });
            // 2. X√≥a ·ªü m·ª•c pending
            await deletePending(id);
        }

        async function deletePending(id) {
            if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?")) return;
            await fetch(`${BASE_URL}pending/${id}.json`, { method: 'DELETE' });
            loadPendingData(); // T·∫£i l·∫°i danh s√°ch
        }
    </script>
</body>
</html>
